# === CSC8607 – Projet JERBI ===
# Dataset : CIFAR-100 (32x32 RGB, 100 classes)
# Modèle : ResNet custom (blocs résiduels)

dataset:
  name: CIFAR100
  root: "./data"
  split:
    train: "torchvision_train"
    val: "stratified_from_train_10pct_seed42"
    test: "torchvision_test"
  download: true
  num_workers: 4
  shuffle: true
  val_ratio: 0.1
  stratified_split: true

preprocess:
  resize: null
  normalize:
    mean: [0.5071, 0.4867, 0.4408]
    std:  [0.2675, 0.2565, 0.2761]
  text_tokenizer: null

augment:
  random_flip:
    enabled: true
    p: 0.5
  random_crop:
    enabled: true
    size: 32
    padding: 4
  color_jitter:
    enabled: true
    brightness: 0.1
    contrast: 0.1
    saturation: 0.1
    hue: 0.05
  spec_augment: null

model:
  type: "resnet_custom"
  num_classes: 100
  input_shape: [3, 32, 32]

  # === Meilleure config issue de la grid search ===
  blocks_per_stage: [3, 3, 3]
  channels_per_stage: [64, 128, 256]

  activation: relu
  dropout: 0.0
  batch_norm: true
  residual: true
  attention: false

train:
  seed: 42
  device: auto
  batch_size: 128
  epochs: 20          # ← entraînement complet
  max_steps: null
  overfit_small: false

  optimizer:
    name: sgd
    lr: 0.002          # ← choisi via grid search
    weight_decay: 0.0001
    momentum: 0.9

optimizer:
  # (copie conservée pour compatibilité éventuelle)
  name: sgd
  lr: 0.002
  weight_decay: 0.0001
  momentum: 0.9

scheduler:
  # Consigne : pas de scheduler en phase finale
  name: none
  step_size: 10
  gamma: 0.1
  warmup_steps: 0

metrics:
  classification:
    - accuracy
  regression: []

# La section hparams n'est plus utilisée après la grid,
# mais on peut la conserver pour traçabilité.
hparams:
  lr: [0.0005, 0.001, 0.002]
  weight_decay: [0.00001, 0.0001]
  blocks_per_stage:
    - [2, 2, 2]
    - [3, 3, 3]
  channels_per_stage:
    - [48, 96, 192]
    - [64, 128, 256]

paths:
  runs_dir: "./runs"
  artifacts_dir: "./artifacts"
